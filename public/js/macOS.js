"use strict";window;var Observable=function(){var e=this;return e.data,e.subs=[],e.methods={publish:function(s){if(void 0===s)return e.data;e.data=s;for(var t=0,o=e.subs.length;t<o;++t)e.subs[t](e.data)},subscribe:function(s){-1===e.subs.indexOf(s)&&e.subs.push(s)},unsubscribe:function(s){-1!==e.subs.indexOf(s)&&e.subs.splice(e.subs.indexOf(s),1)}},e.methods},view={language:document.getElementsByTagName("html")[0].getAttribute("lang"),clock:document.getElementById("clock"),dockAppsLabels:document.querySelectorAll(".dock figcaption"),dockApps:document.querySelectorAll(".dock li"),contextMenuItems:document.querySelectorAll(".dock li div.menu p"),openWindows:document.getElementById("open-windows")},model={dockApps:[],contextMenuItems:[],holdTimer:new Observable,optionsOpened:new Observable,optionsUpdate:new Observable,secondRelease:new Observable,window:new Observable},layoutController={initial:function(){this.correctLabel(view.dockAppsLabels),this.clock()},correctLabel:function(e){for(var s=0,t=e.length;s<t;++s){var o=view.dockApps[s].offsetWidth,n=e[s].offsetWidth;o-n>0?e[s].style.left=(o-n)/2+"px":e[s].style.right=(o-n)/2+"px"}},clock:function(){setInterval(function(){var e=new Date;view.clock.innerHTML=e.toLocaleDateString(view.language+"-BE",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},1e3)}},subscribeController={initial:function(){this.dockMenu(),this.dockMenuUpdate(),this.apps(view.dockApps),this.contextMenus(view.contextMenuItems),this.window()},dockMenu:function(){model.optionsOpened.subscribe(function(e){for(var s=0,t=view.dockApps.length;s<t;++s)view.dockApps[s].classList.contains("options")&&view.dockApps[s].classList.remove("options");null!==e&&(view.dockApps[e].classList.contains("options")||(view.dockApps[e].classList.add("options"),view.dockApps[e].classList.contains("hover")&&view.dockApps[e].classList.remove("hover")))}),model.optionsOpened.publish(null)},dockMenuUpdate:function(){model.optionsUpdate.subscribe(function(){for(var e=0,s=view.dockApps.length;e<s;++e)view.dockApps[e].classList.contains("active")})},apps:function(e){for(var s=function(s,t){var o=new Observable;o.subscribe(function(t){switch(t){case"mouse-over":null!==model.optionsOpened.publish()||e[s].classList.contains("hover")||e[s].classList.add("hover");break;case"mouse-out":e[s].classList.contains("hover")&&e[s].classList.remove("hover");break;case"click":null!==model.optionsOpened.publish()&&model.secondRelease.publish(!0),model.holdTimer.publish(setTimeout(function(){model.optionsOpened.publish(s)},500)),e[s].classList.contains("click")||e[s].classList.add("click");break;case"release":clearTimeout(model.holdTimer.publish()),e[s].classList.contains("click")&&e[s].classList.remove("click"),null===model.optionsOpened.publish()&&model.dockApps[s].publish("active"),null!==model.optionsOpened.publish()&&model.secondRelease.publish()&&(model.optionsOpened.publish(null),model.secondRelease.publish(!1));break;case"active":1!==s&&(e[s].classList.contains("active")||null!==model.optionsOpened.publish()||(appController.open(e[s]),e[s].classList.contains("activate")||e[s].classList.add("activate")));break;case"inactive":e[s].classList.contains("active")&&e[s].classList.remove("active");break;default:console.log("SwitchError in subscribeController.apps")}}),model.dockApps.push(o)},t=0,o=e.length;t<o;++t)s(t)},contextMenus:function(e){for(var s=function(s,t){var o=new Observable;o.subscribe(function(t){var o=e[s].parentElement.parentElement;switch(t){case"mouse-over":e[s].classList.contains("hover")||e[s].classList.add("hover");break;case"mouse-out":e[s].classList.contains("hover")&&e[s].classList.remove("hover");break;case"open":o.classList.contains("active")||(appController.open(o),o.classList.contains("activate")||o.classList.add("activate"));break;case"show":appController.show(o);break;default:console.log("SwitchError in subscribeController.apps")}}),model.contextMenuItems.push(o)},t=0,o=e.length;t<o;++t)s(t)},window:function(){model.window.subscribe(function(e){var s=view.openWindows.innerHTML;view.openWindows.innerHTML=s+e})}},listenerController={initial:function(){this.dockListeners(view.dockApps),this.contextMenuListeners(view.contextMenuItems)},dockListeners:function(e){for(var s=0,t=e.length;s<t;++s)!function(t){var o=s;e[o].children[0].addEventListener("mouseover",function(){model.dockApps[o].publish("mouse-over")}),e[o].children[0].addEventListener("mouseout",function(){model.dockApps[o].publish("mouse-out")}),e[o].children[0].addEventListener("mousedown",function(){model.dockApps[o].publish("click")}),e[o].children[0].addEventListener("mouseup",function(){model.dockApps[o].publish("release")}),e[o].children[0].addEventListener("contextmenu",function(e){e.preventDefault(),model.optionsOpened.publish(o)})}()},contextMenuListeners:function(e){for(var s=0,t=e.length;s<t;++s)!function(t){var o=s;e[o].addEventListener("mouseover",function(){model.contextMenuItems[o].publish("mouse-over")}),e[o].addEventListener("mouseout",function(){model.contextMenuItems[o].publish("mouse-out")}),e[o].addEventListener("click",function(){model.contextMenuItems[o].publish(view.contextMenuItems[o].dataset.action.toLowerCase())})}()}},appController={open:function(e){var s=e.getElementsByClassName("menu")[0].querySelector("p[data-action=open]").dataset.load,t=new XMLHttpRequest;t.open("GET",location.href+s),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&(model.window.publish(t.responseText),model.optionsOpened.publish(null),e.classList.contains("activate")&&e.classList.remove("activate"),e.classList.contains("active")||e.classList.add("active"),model.optionsUpdate.publish(!0))},t.send()},show:function(e){var s=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,o=new XMLHttpRequest;o.open("GET",location.href+s+"/"+t),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&model.window.publish(o.responseText)},o.send()}};layoutController.initial(),subscribeController.initial(),listenerController.initial();