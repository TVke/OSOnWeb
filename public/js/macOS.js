"use strict";var Observable=function(){var e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(var s=0,o=e.subs.length;s<o;++s)e.subs[s](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},view={language:document.getElementsByTagName("html")[0].getAttribute("lang"),clock:document.getElementById("clock"),movers:document.getElementsByClassName("mover"),windows:document.getElementsByClassName("window"),dockAppsLabels:document.querySelectorAll(".dock figcaption"),dockApps:document.querySelectorAll(".dock li"),contextMenuItems:document.querySelectorAll(".dock li div.menu p"),openWindows:document.getElementById("open-windows"),closeButtons:document.getElementsByClassName("close")},model={dockApps:[],contextMenuItems:[],pressed:[],startX:[],startY:[],x:[],y:[],windows:[],holdTimer:new Observable,optionsOpened:new Observable,optionsToggle:new Observable,secondRelease:new Observable,window:new Observable},layoutController={initial:function(){this.correctLabel(view.dockAppsLabels),this.clock()},correctLabel:function(e){for(var t=0,s=e.length;t<s;++t){var o=view.dockApps[t].offsetWidth,n=e[t].offsetWidth;o-n>0?e[t].style.left=(o-n)/2+"px":e[t].style.right=(o-n)/2+"px"}},clock:function(){setInterval(function(){var e=new Date;view.clock.innerHTML=e.toLocaleDateString(view.language+"-BE",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},1e3)}},subscribeController={initial:function(){this.dockMenu(),this.dockMenuUpdate(),this.apps(view.dockApps),this.contextMenus(view.contextMenuItems),this.window()},dockMenu:function(){model.optionsOpened.subscribe(function(e){for(var t=0,s=view.dockApps.length;t<s;++t)view.dockApps[t].classList.contains("options")&&view.dockApps[t].classList.remove("options");null!==e&&(view.dockApps[e].classList.contains("options")||(view.dockApps[e].classList.add("options"),view.dockApps[e].classList.contains("hover")&&view.dockApps[e].classList.remove("hover")))}),model.optionsOpened.publish(null)},dockMenuUpdate:function(){model.optionsToggle.subscribe(function(e){for(var t=e.querySelectorAll("p[data-toggle]"),s=0,o=t.length;s<o;++s){var n=t[s].innerHTML,i=t[s].dataset.action,l=t[s].dataset.load,a=t[s].dataset.toggle,r=t[s].dataset.toggleAction,c=t[s].dataset.toggleLoad;t[s].dataset.toggle=n,t[s].dataset.toggleAction=i,t[s].dataset.toggleLoad=l,t[s].innerHTML=a,t[s].dataset.action=r,t[s].dataset.load=c}})},apps:function(e){for(var t=function(t,s){var o=new Observable;o.subscribe(function(s){switch(s){case"mouse-over":null!==model.optionsOpened.publish()||e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"click":null!==model.optionsOpened.publish()&&model.secondRelease.publish(!0),model.holdTimer.publish(setTimeout(function(){model.optionsOpened.publish(t)},500)),e[t].classList.contains("click")||e[t].classList.add("click");break;case"release":clearTimeout(model.holdTimer.publish()),e[t].classList.contains("click")&&e[t].classList.remove("click"),null===model.optionsOpened.publish()&&model.dockApps[t].publish("active"),null!==model.optionsOpened.publish()&&model.secondRelease.publish()&&(model.optionsOpened.publish(null),model.secondRelease.publish(!1));break;case"active":e[t].classList.contains("active")||(appController.open(e[t]),e[t].classList.contains("activate")||1===t||e[t].classList.add("activate"));break;case"inactive":model.optionsOpened.publish(null),model.optionsToggle.publish(e[t].children[1]),e[t].classList.contains("active")&&e[t].classList.remove("active");break;default:console.log("SwitchError in subscribeController.apps")}}),model.dockApps.push(o)},s=0,o=e.length;s<o;++s)t(s)},contextMenus:function(e){for(var t=function(t,s){var o=new Observable;o.subscribe(function(s){var o=e[t].parentElement.parentElement,n=dockController.findIndex(o);switch(s){case"mouse-over":e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"open":model.dockApps[n].publish("active");break;case"show":appController.file(o);break;case"new":appController.dir(o);break;case"stop":windowController.closeAllWindowsFrom(e[t].dataset.load),model.dockApps[n].publish("inactive");break;case"restart":location.reload();break;default:console.log("SwitchError in subscribeController.apps")}}),model.contextMenuItems.push(o)},s=0,o=e.length;s<o;++s)t(s)},window:function(){model.window.subscribe(function(e){var t=view.openWindows.innerHTML;view.openWindows.innerHTML=t+e})}},listenerController={initial:function(){this.dockListeners(view.dockApps),this.contextMenuListeners(view.contextMenuItems)},dockListeners:function(e){for(var t=0,s=e.length;t<s;++t)!function(s){var o=t;e[o].children[0].addEventListener("mouseover",function(){model.dockApps[o].publish("mouse-over")}),e[o].children[0].addEventListener("mouseout",function(){model.dockApps[o].publish("mouse-out")}),e[o].children[0].addEventListener("mousedown",function(){model.dockApps[o].publish("click")}),e[o].children[0].addEventListener("mouseup",function(){model.dockApps[o].publish("release")}),e[o].children[0].addEventListener("contextmenu",function(e){e.preventDefault(),model.optionsOpened.publish(o)})}()},contextMenuListeners:function(e){for(var t=0,s=e.length;t<s;++t)!function(s){var o=t;e[o].addEventListener("mouseover",function(){model.contextMenuItems[o].publish("mouse-over")}),e[o].addEventListener("mouseout",function(){model.contextMenuItems[o].publish("mouse-out")}),e[o].addEventListener("click",function(e){e.preventDefault(),model.contextMenuItems[o].publish(view.contextMenuItems[o].dataset.action.toLowerCase())})}()}},dockController={findIndex:function(e){for(var t=0,s=view.dockApps.length;t<s;++t)if(view.dockApps[t]===e)return t},getName:function(e){return view.dockApps[e].children[0].children[0].dataset.name}},appController={open:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=open]").dataset.load,s=new XMLHttpRequest;if(s.open("GET",location.href+t),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(model.window.publish(s.responseText),windowController.new(e))},s.send(),document.querySelectorAll("script[src*="+dockController.getName(dockController.findIndex(e))+"]").length<1){var o=document.createElement("script");o.src="/js"+t+".js",document.body.appendChild(o)}},file:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,s=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,o=new XMLHttpRequest;o.open("GET",location.href+t+"/"+s),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&model.window.publish(o.responseText)},o.send()},dir:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,s=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,o=new XMLHttpRequest;o.open("GET",location.href+t+"/"+s),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&model.window.publish(o.responseText)},o.send()}},windowController={new:function(e){e.classList.contains("activate")&&e.classList.remove("activate"),e.classList.contains("active")||e.classList.add("active"),this.windowPlacement(view.windows[view.windows.length-1],130,150),this.moveSubscribers(view.movers),this.moverListeners(view.movers),this.closeButtonListen(view.closeButtons),model.optionsOpened.publish(null),model.optionsToggle.publish(e.getElementsByClassName("menu")[0])},closeButtonListen:function(e){for(var t=0,s=e.length;t<s;++t)e[t].addEventListener("click",function(e){e.preventDefault(),e.target.removeEventListener("click",this);var t=e.target.parentElement.parentElement,s=windowController.getAppIndex(t);t.remove(),windowController.anyWindowsOpen(s)||model.dockApps[s].publish("inactive")})},closeAllWindowsFrom:function(e){for(var t=0,s=view.openWindows.children.length;t<s;++t)view.openWindows.children[t].classList.contains(e)&&view.openWindows.children[t].remove()},getAppIndex:function(e){for(var t=0,s=view.dockApps.length;t<s;++t)if(e.classList.contains(dockController.getName(t)))return t},anyWindowsOpen:function(e){for(var t=!1,s=0,o=view.openWindows.children.length;s<o;++s)if(view.openWindows.children[s].classList.contains(dockController.getName(e))){t=!0;break}return t},moverListeners:function(e){for(var t=0,s=e.length;t<s;++t)model.pressed.push(new Observable),model.startX.push(new Observable),model.startY.push(new Observable),e[o=t].addEventListener("mousedown",function(e){model.pressed[o].publish(!0),model.startX[o].publish(e.x),model.startY[o].publish(e.y)}),e[o].addEventListener("mousemove",function(e){e.preventDefault(),model.pressed[o].publish()&&(model.x[o].publish(e.x),model.y[o].publish(e.y))}),e[o].addEventListener("mouseup",function(e){model.pressed[o].publish(!1),model.startX[o].publish(e.x),model.startY[o].publish(e.y)}),e[o].addEventListener("mouseout",function(e){model.pressed[o].publish(!1),model.startX[o].publish(e.x),model.startY[o].publish(e.y)});var o},moveSubscribers:function(e){for(var t=function(e,t){var s=new Observable,o=new Observable;s.subscribe(function(t){var s=parseInt(view.windows[e].style.left),o=t-model.startX[e].publish();view.windows[e].style.left=o+s+"px",model.startX[e].publish(t)}),o.subscribe(function(t){var s=parseInt(view.windows[e].style.top),o=t-model.startY[e].publish();view.windows[e].style.top=o+s+"px",model.startY[e].publish(t)}),model.x.push(s),model.y.push(o)},s=0,o=e.length;s<o;++s)t(s)},windowPlacement:function(e,t,s){e.style.left=t+"px",e.style.top=s+"px"}};layoutController.initial(),subscribeController.initial(),listenerController.initial();