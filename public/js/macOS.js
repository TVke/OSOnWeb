"use strict";window;var Observable=function(){var e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(var n=0,o=e.subs.length;n<o;++n)e.subs[n](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},view={language:document.getElementsByTagName("html")[0].getAttribute("lang"),clock:document.getElementById("clock"),dockAppsLabels:document.querySelectorAll(".dock figcaption"),dockApps:document.querySelectorAll(".dock li"),contextMenuItems:document.querySelectorAll(".dock li div.menu p"),openWindows:document.getElementById("open-windows"),closeButtons:document.getElementsByClassName("close")},model={dockApps:[],contextMenuItems:[],holdTimer:new Observable,optionsOpened:new Observable,optionsToggle:new Observable,secondRelease:new Observable,window:new Observable},layoutController={initial:function(){this.correctLabel(view.dockAppsLabels),this.clock()},correctLabel:function(e){for(var t=0,n=e.length;t<n;++t){var o=view.dockApps[t].offsetWidth,s=e[t].offsetWidth;o-s>0?e[t].style.left=(o-s)/2+"px":e[t].style.right=(o-s)/2+"px"}},clock:function(){setInterval(function(){var e=new Date;view.clock.innerHTML=e.toLocaleDateString(view.language+"-BE",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},1e3)}},subscribeController={initial:function(){this.dockMenu(),this.dockMenuUpdate(),this.apps(view.dockApps),this.contextMenus(view.contextMenuItems),this.window()},dockMenu:function(){model.optionsOpened.subscribe(function(e){for(var t=0,n=view.dockApps.length;t<n;++t)view.dockApps[t].classList.contains("options")&&view.dockApps[t].classList.remove("options");null!==e&&(view.dockApps[e].classList.contains("options")||(view.dockApps[e].classList.add("options"),view.dockApps[e].classList.contains("hover")&&view.dockApps[e].classList.remove("hover")))}),model.optionsOpened.publish(null)},dockMenuUpdate:function(){model.optionsToggle.subscribe(function(e){for(var t=e.querySelectorAll("p[data-toggle]"),n=0,o=t.length;n<o;++n){var s=t[n].innerHTML,i=t[n].dataset.action,l=t[n].dataset.load,a=t[n].dataset.toggle,c=t[n].dataset.toggleAction,r=t[n].dataset.toggleLoad;t[n].dataset.toggle=s,t[n].dataset.toggleAction=i,t[n].dataset.toggleLoad=l,t[n].innerHTML=a,t[n].dataset.action=c,t[n].dataset.load=r}})},apps:function(e){for(var t=function(t,n){var o=new Observable;o.subscribe(function(n){switch(n){case"mouse-over":null!==model.optionsOpened.publish()||e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"click":null!==model.optionsOpened.publish()&&model.secondRelease.publish(!0),model.holdTimer.publish(setTimeout(function(){model.optionsOpened.publish(t)},500)),e[t].classList.contains("click")||e[t].classList.add("click");break;case"release":clearTimeout(model.holdTimer.publish()),e[t].classList.contains("click")&&e[t].classList.remove("click"),null===model.optionsOpened.publish()&&model.dockApps[t].publish("active"),null!==model.optionsOpened.publish()&&model.secondRelease.publish()&&(model.optionsOpened.publish(null),model.secondRelease.publish(!1));break;case"active":1!==t&&(e[t].classList.contains("active")||(appController.open(e[t]),e[t].classList.contains("activate")||e[t].classList.add("activate")));break;case"inactive":console.log(e[t]),model.optionsOpened.publish(null),model.optionsToggle.publish(e[t].children[1]),e[t].classList.contains("active")&&e[t].classList.remove("active");break;default:console.log("SwitchError in subscribeController.apps")}}),model.dockApps.push(o)},n=0,o=e.length;n<o;++n)t(n)},contextMenus:function(e){for(var t=function(t,n){var o=new Observable;o.subscribe(function(n){var o=e[t].parentElement.parentElement,s=dockController.findIndex(o);switch(n){case"mouse-over":e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"open":model.dockApps[s].publish("active");break;case"show":appController.file(o);break;case"new":appController.dir(o);break;case"stop":windowController.closeAllWindowsFrom(e[t].dataset.load),model.dockApps[s].publish("inactive");break;case"restart":location.reload();break;default:console.log("SwitchError in subscribeController.apps")}}),model.contextMenuItems.push(o)},n=0,o=e.length;n<o;++n)t(n)},window:function(){model.window.subscribe(function(e){var t=view.openWindows.innerHTML;view.openWindows.innerHTML=t+e})}},listenerController={initial:function(){this.dockListeners(view.dockApps),this.contextMenuListeners(view.contextMenuItems)},dockListeners:function(e){for(var t=0,n=e.length;t<n;++t)!function(n){var o=t;e[o].children[0].addEventListener("mouseover",function(){model.dockApps[o].publish("mouse-over")}),e[o].children[0].addEventListener("mouseout",function(){model.dockApps[o].publish("mouse-out")}),e[o].children[0].addEventListener("mousedown",function(){model.dockApps[o].publish("click")}),e[o].children[0].addEventListener("mouseup",function(){model.dockApps[o].publish("release")}),e[o].children[0].addEventListener("contextmenu",function(e){e.preventDefault(),model.optionsOpened.publish(o)})}()},contextMenuListeners:function(e){for(var t=0,n=e.length;t<n;++t)!function(n){var o=t;e[o].addEventListener("mouseover",function(){model.contextMenuItems[o].publish("mouse-over")}),e[o].addEventListener("mouseout",function(){model.contextMenuItems[o].publish("mouse-out")}),e[o].addEventListener("click",function(e){e.preventDefault(),model.contextMenuItems[o].publish(view.contextMenuItems[o].dataset.action.toLowerCase())})}()}},dockController={findIndex:function(e){for(var t=0,n=view.dockApps.length;t<n;++t)if(view.dockApps[t]===e)return t},getName:function(e){return view.dockApps[e].children[0].children[0].dataset.name}},appController={open:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=open]").dataset.load,n=new XMLHttpRequest;n.open("GET",location.href+t),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(model.window.publish(n.responseText),windowController.new(e))},n.send();var o=document.createElement("script");o.src="/js"+t+".js",document.body.appendChild(o)},file:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,n=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,o=new XMLHttpRequest;o.open("GET",location.href+t+"/"+n),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&model.window.publish(o.responseText)},o.send()},dir:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,n=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,o=new XMLHttpRequest;o.open("GET",location.href+t+"/"+n),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&model.window.publish(o.responseText)},o.send()}},windowController={new:function(e){e.classList.contains("activate")&&e.classList.remove("activate"),e.classList.contains("active")||e.classList.add("active"),this.closeButtonListen(view.closeButtons),model.optionsOpened.publish(null),model.optionsToggle.publish(e.getElementsByClassName("menu")[0])},closeButtonListen:function(e){for(var t=0,n=e.length;t<n;++t)e[t].addEventListener("click",function(e){e.preventDefault(),e.target.removeEventListener("click",this);var t=e.target.parentElement.parentElement,n=windowController.getAppIndex(t);t.remove(),windowController.anyWindowsOpen(n)||model.dockApps[n].publish("inactive")})},closeAllWindowsFrom:function(e){for(var t=0,n=view.openWindows.children.length;t<n;++t)view.openWindows.children[t].classList.contains(e)&&view.openWindows.children[t].remove()},getAppIndex:function(e){for(var t=0,n=view.dockApps.length;t<n;++t)if(e.classList.contains(dockController.getName(t)))return t},anyWindowsOpen:function(e){for(var t=!1,n=0,o=view.openWindows.children.length;n<o;++n)if(view.openWindows.children[n].classList.contains(dockController.getName(e))){t=!0;break}return t}};layoutController.initial(),subscribeController.initial(),listenerController.initial();