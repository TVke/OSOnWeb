"use strict";window;var Observable=function(){var e=this;return e.data,e.subs=[],e.methods={publish:function(t){if(void 0===t)return e.data;e.data=t;for(var o=0,s=e.subs.length;o<s;++o)e.subs[o](e.data)},subscribe:function(t){-1===e.subs.indexOf(t)&&e.subs.push(t)},unsubscribe:function(t){-1!==e.subs.indexOf(t)&&e.subs.splice(e.subs.indexOf(t),1)}},e.methods},view={language:document.getElementsByTagName("html")[0].getAttribute("lang"),clock:document.getElementById("clock"),movers:document.getElementsByClassName("mover"),windows:document.getElementsByClassName("window"),dockAppsLabels:document.querySelectorAll(".dock figcaption"),dockApps:document.querySelectorAll(".dock li"),contextMenuItems:document.querySelectorAll(".dock li div.menu p"),openWindows:document.getElementById("open-windows"),closeButtons:document.getElementsByClassName("close")},model={dockApps:[],contextMenuItems:[],pressed:[],startX:[],startY:[],x:[],y:[],windows:[],holdTimer:new Observable,optionsOpened:new Observable,optionsToggle:new Observable,secondRelease:new Observable,window:new Observable},layoutController={initial:function(){this.correctLabel(view.dockAppsLabels),this.clock()},correctLabel:function(e){for(var t=0,o=e.length;t<o;++t){var s=view.dockApps[t].offsetWidth,n=e[t].offsetWidth;s-n>0?e[t].style.left=(s-n)/2+"px":e[t].style.right=(s-n)/2+"px"}},clock:function(){setInterval(function(){var e=new Date;view.clock.innerHTML=e.toLocaleDateString(view.language+"-BE",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},1e3)}},subscribeController={initial:function(){this.dockMenu(),this.dockMenuUpdate(),this.apps(view.dockApps),this.contextMenus(view.contextMenuItems),this.window()},dockMenu:function(){model.optionsOpened.subscribe(function(e){for(var t=0,o=view.dockApps.length;t<o;++t)view.dockApps[t].classList.contains("options")&&view.dockApps[t].classList.remove("options");null!==e&&(view.dockApps[e].classList.contains("options")||(view.dockApps[e].classList.add("options"),view.dockApps[e].classList.contains("hover")&&view.dockApps[e].classList.remove("hover")))}),model.optionsOpened.publish(null)},dockMenuUpdate:function(){model.optionsToggle.subscribe(function(e){for(var t=e.querySelectorAll("p[data-toggle]"),o=0,s=t.length;o<s;++o){var n=t[o].innerHTML,i=t[o].dataset.action,l=t[o].dataset.load,a=t[o].dataset.toggle,r=t[o].dataset.toggleAction,c=t[o].dataset.toggleLoad;t[o].dataset.toggle=n,t[o].dataset.toggleAction=i,t[o].dataset.toggleLoad=l,t[o].innerHTML=a,t[o].dataset.action=r,t[o].dataset.load=c}})},apps:function(e){for(var t=function(t,o){var s=new Observable;s.subscribe(function(o){switch(o){case"mouse-over":null!==model.optionsOpened.publish()||e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"click":null!==model.optionsOpened.publish()&&model.secondRelease.publish(!0),model.holdTimer.publish(setTimeout(function(){model.optionsOpened.publish(t)},500)),e[t].classList.contains("click")||e[t].classList.add("click");break;case"release":clearTimeout(model.holdTimer.publish()),e[t].classList.contains("click")&&e[t].classList.remove("click"),null===model.optionsOpened.publish()&&model.dockApps[t].publish("active"),null!==model.optionsOpened.publish()&&model.secondRelease.publish()&&(model.optionsOpened.publish(null),model.secondRelease.publish(!1));break;case"active":e[t].classList.contains("active")||(appController.open(e[t]),e[t].classList.contains("activate")||1===t||e[t].classList.add("activate"));break;case"inactive":model.optionsOpened.publish(null),model.optionsToggle.publish(e[t].children[1]),e[t].classList.contains("active")&&e[t].classList.remove("active");break;default:console.log("SwitchError in subscribeController.apps")}}),model.dockApps.push(s)},o=0,s=e.length;o<s;++o)t(o)},contextMenus:function(e){for(var t=function(t,o){var s=new Observable;s.subscribe(function(o){var s=e[t].parentElement.parentElement,n=dockController.findIndex(s);switch(o){case"mouse-over":e[t].classList.contains("hover")||e[t].classList.add("hover");break;case"mouse-out":e[t].classList.contains("hover")&&e[t].classList.remove("hover");break;case"open":model.dockApps[n].publish("active");break;case"show":appController.file(s);break;case"new":appController.dir(s);break;case"stop":windowController.closeAllWindowsFrom(e[t].dataset.load),model.dockApps[n].publish("inactive");break;case"restart":location.reload();break;default:console.log("SwitchError in subscribeController.apps")}}),model.contextMenuItems.push(s)},o=0,s=e.length;o<s;++o)t(o)},window:function(){model.window.subscribe(function(e){var t=view.openWindows.innerHTML;view.openWindows.innerHTML=t+e})}},listenerController={initial:function(){this.dockListeners(view.dockApps),this.contextMenuListeners(view.contextMenuItems)},dockListeners:function(e){for(var t=0,o=e.length;t<o;++t)!function(o){var s=t;e[s].children[0].addEventListener("mouseover",function(){model.dockApps[s].publish("mouse-over")}),e[s].children[0].addEventListener("mouseout",function(){model.dockApps[s].publish("mouse-out")}),e[s].children[0].addEventListener("mousedown",function(){model.dockApps[s].publish("click")}),e[s].children[0].addEventListener("mouseup",function(){model.dockApps[s].publish("release")}),e[s].children[0].addEventListener("contextmenu",function(e){e.preventDefault(),model.optionsOpened.publish(s)})}()},contextMenuListeners:function(e){for(var t=0,o=e.length;t<o;++t)!function(o){var s=t;e[s].addEventListener("mouseover",function(){model.contextMenuItems[s].publish("mouse-over")}),e[s].addEventListener("mouseout",function(){model.contextMenuItems[s].publish("mouse-out")}),e[s].addEventListener("click",function(e){e.preventDefault(),model.contextMenuItems[s].publish(view.contextMenuItems[s].dataset.action.toLowerCase())})}()}},dockController={findIndex:function(e){for(var t=0,o=view.dockApps.length;t<o;++t)if(view.dockApps[t]===e)return t},getName:function(e){return view.dockApps[e].children[0].children[0].dataset.name}},appController={open:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=open]").dataset.load,o=new XMLHttpRequest;if(o.open("GET",location.href+t),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&(model.window.publish(o.responseText),windowController.new(e))},o.send(),document.querySelectorAll("script[src*="+dockController.getName(dockController.findIndex(e))+"]").length<1){var s=document.createElement("script");s.src="/js"+t+".js",document.body.appendChild(s)}},file:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,o=e.getElementsByClassName("menu")[0].querySelector("p[data-action=show]").dataset.load,s=new XMLHttpRequest;s.open("GET",location.href+t+"/"+o),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&model.window.publish(s.responseText)},s.send()},dir:function(e){var t=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,o=e.getElementsByClassName("menu")[0].querySelector("p[data-action=new]").dataset.load,s=new XMLHttpRequest;s.open("GET",location.href+t+"/"+o),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&model.window.publish(s.responseText)},s.send()}},windowController={new:function(e){e.classList.contains("activate")&&e.classList.remove("activate"),e.classList.contains("active")||e.classList.add("active"),this.windowPlacement(view.windows[view.windows.length-1],130,150),this.moveSubscribers(view.movers),this.moverListeners(view.movers),this.closeButtonListen(view.closeButtons),model.optionsOpened.publish(null),model.optionsToggle.publish(e.getElementsByClassName("menu")[0])},closeButtonListen:function(e){for(var t=0,o=e.length;t<o;++t)e[t].addEventListener("click",function(e){e.preventDefault(),e.target.removeEventListener("click",this);var t=e.target.parentElement.parentElement,o=windowController.getAppIndex(t);t.remove(),windowController.anyWindowsOpen(o)||model.dockApps[o].publish("inactive")})},closeAllWindowsFrom:function(e){for(var t=0,o=view.openWindows.children.length;t<o;++t)view.openWindows.children[t].classList.contains(e)&&view.openWindows.children[t].remove()},getAppIndex:function(e){for(var t=0,o=view.dockApps.length;t<o;++t)if(e.classList.contains(dockController.getName(t)))return t},anyWindowsOpen:function(e){for(var t=!1,o=0,s=view.openWindows.children.length;o<s;++o)if(view.openWindows.children[o].classList.contains(dockController.getName(e))){t=!0;break}return t},moverListeners:function(e){for(var t=0,o=e.length;t<o;++t)model.pressed.push(new Observable),model.startX.push(new Observable),model.startY.push(new Observable),e[s=t].addEventListener("mousedown",function(e){model.pressed[s].publish(!0),model.startX[s].publish(e.x),model.startY[s].publish(e.y)}),e[s].addEventListener("mousemove",function(e){e.preventDefault(),model.pressed[s].publish()&&(model.x[s].publish(e.x),model.y[s].publish(e.y))}),e[s].addEventListener("mouseup",function(e){model.pressed[s].publish(!1),model.startX[s].publish(e.x),model.startY[s].publish(e.y)}),e[s].addEventListener("mouseout",function(e){model.pressed[s].publish(!1),model.startX[s].publish(e.x),model.startY[s].publish(e.y)});var s},moveSubscribers:function(e){for(var t=function(e,t){var o=new Observable,s=new Observable;o.subscribe(function(t){var o=parseInt(view.windows[e].style.left),s=t-model.startX[e].publish();view.windows[e].style.left=s+o+"px",model.startX[e].publish(t)}),s.subscribe(function(t){var o=parseInt(view.windows[e].style.top),s=t-model.startY[e].publish();view.windows[e].style.top=s+o+"px",model.startY[e].publish(t)}),model.x.push(o),model.y.push(s)},o=0,s=e.length;o<s;++o)t(o)},windowPlacement:function(e,t,o){e.style.left=t+"px",e.style.top=o+"px"}};layoutController.initial(),subscribeController.initial(),listenerController.initial();